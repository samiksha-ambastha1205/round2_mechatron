<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Baker Street Ledger | Case Files</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles for the Victorian Detective Theme */
        :root {
            --charcoal-black: #1a1a1a;
            --deep-brown: #3d2c1d;
            --brass-gold: #c89f68;
            --sepia-beige: #f0e5d1;
            --crimson-red: #8a0303;
        }

        body {
            background-color: var(--charcoal-black);
            background-image: 
                linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
                url('https://www.transparenttextures.com/patterns/dark-wood.png');
            font-family: 'Special Elite', monospace;
            color: var(--charcoal-black);
            overflow-x: hidden;
            position: relative;
        }

        /* --- Atmospheric Effects --- */
        #fog-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
            background: 
                radial-gradient(circle at 10% 90%, rgba(100,100,100,0.1) 0%, transparent 40%),
                radial-gradient(circle at 85% 20%, rgba(100,100,100,0.1) 0%, transparent 50%);
        }
        #fog-layer::before, #fog-layer::after {
            content: ''; position: absolute; width: 200%; height: 100%;
            background: transparent;
            background-image: linear-gradient(transparent, rgba(50, 50, 50, 0.2), transparent);
            opacity: 0.3; animation: drift 60s linear infinite;
        }
        #fog-layer::before { animation-duration: 75s; }
        #fog-layer::after { animation-duration: 90s; animation-direction: reverse; }

        @keyframes drift {
            from { transform: translateX(-50%); }
            to { transform: translateX(50%); }
        }

        #gas-lamp-flicker {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 99;
            background: 
                radial-gradient(circle at 5% 5%, rgba(200, 159, 104, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 95% 95%, rgba(200, 159, 104, 0.15) 0%, transparent 20%);
            animation: flicker 5s infinite alternate;
        }

        @keyframes flicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% { opacity: 0.6; }
            20%, 24%, 55% { opacity: 0.5; }
        }
        
        /* --- Typography --- */
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            color: var(--deep-brown);
        }

        /* --- Header --- */
        .header-plate {
            background: linear-gradient(145deg, #a78051, #d3ad7c);
            border: 2px solid #7c5c3c;
            box-shadow: 0 0 10px rgba(0,0,0,0.5), inset 0 0 5px rgba(255,255,255,0.2);
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
            color: var(--charcoal-black);
        }

        /* --- Navigation Tabs --- */
        .nav-tab {
            background-color: #a08a70;
            clip-path: polygon(0 0, 100% 0, 95% 100%, 5% 100%);
            transition: all 0.3s ease; position: relative; top: 0;
            color: var(--sepia-beige); text-shadow: 1px 1px #3d2c1d;
        }
        .nav-tab:hover { background-color: var(--brass-gold); top: -2px; color: white; }

        /* --- Paper Card Style --- */
        .paper-card {
            background-color: var(--sepia-beige);
            background-image: url('https://www.transparenttextures.com/patterns/old-paper.png');
            box-shadow: 5px 5px 15px rgba(0,0,0,0.6), inset 0 0 40px rgba(0,0,0,0.2);
            border: 1px solid #c3b5a0; border-radius: 3px;
            position: relative; overflow: hidden; /* Important for edge effect */
        }
        .paper-card::after { /* Burnt edge effect */
            content: ''; position: absolute; top: -10px; right: -10px; bottom: -10px; left: -10px;
            background: transparent; box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
            pointer-events: none; filter: blur(3px); border-radius: 5px;
        }
        .paper-card h2 { border-bottom: 2px double var(--deep-brown); }

        /* --- Evidence Board --- */
        .evidence-board {
            background-color: #6d5b4b;
            background-image: url('https://www.transparenttextures.com/patterns/cork-wallet.png');
            border: 8px solid var(--deep-brown);
            box-shadow: 0 10px 20px rgba(0,0,0,0.7);
        }
        .evidence-item {
            position: relative; box-shadow: 3px 3px 5px rgba(0,0,0,0.5); transition: all 0.3s ease;
        }
        .evidence-item:hover { transform: scale(1.05) rotate(1deg); z-index: 10; }
        .evidence-item.note { background-color: #fff9e8; padding: 0.5rem; transform: rotate(-2deg); }
        .evidence-item.photo { background-color: white; border: 8px solid white; transform: rotate(3deg); }
        .pin {
            position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
            width: 12px; height: 12px; background: radial-gradient(circle, #f00, #a00);
            border-radius: 50%; box-shadow: 1px 1px 2px rgba(0,0,0,0.5); z-index: 1;
        }
        .red-string {
            position: absolute; border-top: 2px solid var(--crimson-red);
            opacity: 0.8; z-index: -1; box-shadow: 0 0 5px var(--crimson-red);
        }

        /* --- Hidden Clues --- */
        .hidden-clue .clue-text { visibility: hidden; opacity: 0; transition: opacity 0.5s ease; }
        .hidden-clue:hover .clue-text { visibility: visible; opacity: 1; }
        .hidden-clue:hover { background-color: rgba(200, 159, 104, 0.1); }

        /* --- Buttons --- */
        .wax-seal-btn {
            background: var(--crimson-red); color: var(--sepia-beige);
            border-radius: 50%; width: 80px; height: 80px; border: 3px solid #6b0202;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
            box-shadow: 0 0 0 4px var(--crimson-red), 0 0 0 5px #6b0202, inset 0 0 10px rgba(0,0,0,0.4);
            position: relative; transition: all 0.3s ease;
        }
        .wax-seal-btn:hover { transform: scale(1.1); background: #a80303; }
        .wax-seal-btn .icon { filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.5)); }

        /* --- Footer --- */
        .footer-strip {
            background-color: #2a2a2a; color: var(--sepia-beige);
            font-family: 'Special Elite', monospace; border-top: 3px solid var(--brass-gold);
            text-align: center;
        }
        
        /* --- Anti-Cheat Overlay & Info Boxes --- */
        .warning-overlay {
            position: fixed; inset: 0; background-color: rgba(42, 1, 1, 0.7); backdrop-filter: blur(10px);
            display: none; justify-content: center; align-items: center; z-index: 1001;
            color: var(--sepia-beige); text-align: center; font-family: 'Playfair Display', serif;
        }
        .entry-content {
            background: rgba(0,0,0,0.4); border: 2px solid var(--brass-gold); border-radius: 8px; padding: 40px;
            max-width: 500px; animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .resume-button {
            color: var(--charcoal-black); padding: 12px 24px; border: none; border-radius: 4px;
            margin-top: 20px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: transform 0.2s ease;
            background: linear-gradient(145deg, #a78051, #d3ad7c);
        }
        .resume-button:hover { transform: scale(1.05); }
        
        .info-box {
            background: rgba(0,0,0,0.3); backdrop-filter: blur(5px);
            border: 1px solid var(--brass-gold); color: var(--sepia-beige);
            padding: 1rem; border-radius: 4px;
        }
        .info-box h2 { color: var(--sepia-beige); opacity: 0.8; }
    </style>
</head>
<body class="min-h-screen">
    <!-- Security Overlays -->
    <div id="esc-warning-1" class="warning-overlay"><div class="entry-content"><h2>Security Warning 1 of 2</h2><p>Exiting fullscreen is a breach of protocol.</p><button class="resume-button">Resume Review</button></div></div>
    <div id="esc-warning-2" class="warning-overlay"><div class="entry-content"><h2>Final Warning</h2><p>A further breach will terminate the session and lock the archives.</p><button class="resume-button">Resume Review</button></div></div>
    <div id="tab-warning-1" class="warning-overlay"><div class="entry-content"><h2>Security Warning 1 of 2</h2><p>Switching focus from the case file is a breach of protocol.</p><button class="resume-button">Resume Review</button></div></div>
    <div id="tab-warning-2" class="warning-overlay"><div class="entry-content"><h2>Final Warning</h2><p>A further breach will terminate the session and lock the archives.</p><button class="resume-button">Resume Review</button></div></div>

    <div class="case-wrapper" style="display: none;">
        <!-- Atmospheric overlays -->
        <div id="fog-layer"></div>
        <div id="gas-lamp-flicker"></div>

        <div class="container mx-auto p-4 md:p-8 relative z-10">
            <!-- Info Boxes -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="info-box">
                    <h2 class="text-lg">Team ID</h2>
                    <span id="agent-id-display" class="text-2xl font-bold">Loading...</span>
                </div>
                <div class="info-box md:text-right">
                    <h2 class="text-lg">Case Timer</h2>
                    <span id="case-timer" class="text-2xl font-bold">15:00</span>
                </div>
            </div>

            <!-- Header: Brass Nameplate -->
            <header class="header-plate p-4 my-6 rounded-lg text-center">
                <h1 class="text-3xl md:text-5xl tracking-widest">THE BAKER STREET LEDGER</h1>
                <p class="text-sm md:text-base tracking-wider">Consulting Detectives of Distinction</p>
            </header>

            <!-- Navigation: Folder Tabs -->
            <nav class="flex justify-center gap-2 md:gap-4 -mb-px relative z-20">
                <a href="#" class="nav-tab px-4 py-2 md:px-8 md:py-3 rounded-t-lg">Case Files</a>
                <a href="#" class="nav-tab px-4 py-2 md:px-8 md:py-3 rounded-t-lg">Services</a>
                <a href="#" class="nav-tab px-4 py-2 md:px-8 md:py-3 rounded-t-lg">Testimonials</a>
                <a href="#" class="nav-tab px-4 py-2 md:px-8 md:py-3 rounded-t-lg">Contact</a>
            </nav>

            <!-- Main Content Wrapper -->
            <div class="bg-black/20 p-4 md:p-8 rounded-b-lg rounded-tr-lg shadow-2xl">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <!-- Main Section: Case Files -->
                    <main class="lg:col-span-2 space-y-8">
                        <article class="paper-card p-6">
                            <h2 class="text-2xl pb-2 mb-4">The Case of the Crimson Quill</h2>
                            <p class="mb-4">It was a dreary Tuesday when the case landed upon our doorstep, delivered by a frantic Lord Harrington. His prized possession, a quill said to have been plucked from a phoenix and dipped in dragon's blood, had vanished from a locked room. The only clue? A single, crimson-tinged raven's feather left upon his writing desk.</p>
                            <p class="hidden-clue p-2 rounded">The manor's floor plans revealed a hidden servant's passage behind the library bookshelf. <span class="clue-text font-bold text-red-800">Motive: a disgruntled scholar, perhaps?</span></p>
                        </article>

                        <article class="paper-card p-6">
                            <h2 class="text-2xl pb-2 mb-4">The Enigma of the Silent Songbird</h2>
                            <p class="mb-4">Famed opera singer, Madame Dubois, lost her voice mid-aria, collapsing on stage. Doctors were baffled, citing no physical cause. Whispers of a curse spread through the London elite. We were summoned to the Royal Opera House to investigate what medicine could not explain. The dressing room was filled with flowers, but one bouquet of lilies smelled faintly of almonds...</p>
                            <div class="flex justify-end mt-4">
                                <button class="wax-seal-btn flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 icon" viewBox="0 0 20 20" fill="currentColor">
                                      <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </article>
                    </main>

                    <!-- Sidebar: Evidence Board -->
                    <aside class="lg:col-span-1">
                        <div class="evidence-board h-full p-4 rounded-lg relative">
                            <h3 class="text-center text-2xl text-sepia-beige mb-6" style="text-shadow: 2px 2px 2px #3d2c1d;">Active Investigation</h3>
                            <div id="clue1" class="evidence-item photo p-2 absolute" style="top: 80px; left: 10%;">
                                 <div class="pin"></div>
                                 <img src="https://placehold.co/150x100/333/ccc?text=Lord+Harrington" alt="Lord Harrington Portrait" class="filter grayscale sepia">
                            </div>
                            <div id="clue2" class="evidence-item note p-2 absolute" style="top: 150px; right: 5%;">
                                 <div class="pin"></div>
                                 <p class="text-sm">Feather matches <br> Corvus corax. <br> Not native to city centre.</p>
                            </div>
                            <div id="clue3" class="evidence-item photo p-1 absolute" style="top: 250px; left: 25%;">
                                <div class="pin"></div>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4.5C14.8284 4.5 17.5 5.59695 19.2361 7.33306C20.9722 9.06917 22 11.7408 22 14.5C22 17.2592 20.9722 19.9308 19.2361 21.6669C17.5 23.4031 14.8284 24.5 12 24.5C9.17157 24.5 6.5 23.4031 4.76393 21.6669C3.02784 19.9308 2 17.2592 2 14.5C2 11.7408 3.02784 9.06917 4.76393 7.33306C6.5 5.59695 9.17157 4.5 12 4.5M12 4.5C12 4.5 13.5 8.5 13.5 10.5C13.5 12.5 12 14.5 12 16.5C12 18.5 10.5 20.5 10.5 22.5" transform="rotate(45 12 12)"/>
                                </svg>
                                <p class="text-xs text-center -mt-4">Fingerprint</p>
                            </div>
                            <div id="clue4" class="evidence-item note p-2 absolute" style="top: 380px; right: 15%;">
                                 <div class="pin"></div>
                                 <p class="text-sm">Note found: <br> "The bird sings<br> only for the worthy."</p>
                            </div>
                            <div class="red-string" style="width: 45%; top: 180px; left: 25%; transform: rotate(25deg);"></div>
                            <div class="red-string" style="width: 50%; top: 290px; left: 45%; transform: rotate(-30deg);"></div>
                        </div>
                    </aside>
                </div>
            </div>

            <!-- Footer -->
            <footer class="footer-strip mt-8 p-4 rounded-lg">
                <p>&copy; 1887 The Baker Street Ledger. All Cases Considered. All Communications Confidential.</p>
            </footer>

        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const caseWrapper = document.querySelector('.case-wrapper');
            const agentIdDisplay = document.getElementById('agent-id-display');
            const timerDisplay = document.getElementById('case-timer');
            
            const overlays = {
                esc1: document.getElementById('esc-warning-1'),
                esc2: document.getElementById('esc-warning-2'),
                tab1: document.getElementById('tab-warning-1'),
                tab2: document.getElementById('tab-warning-2'),
            };

            document.querySelectorAll('.resume-button').forEach(btn => btn.addEventListener('click', resumeFromWarning));

            let caseTimer;
            let sessionHasEnded = false;
            let agentId = '';
            let escWarningCount = 0;
            let tabSwitchCount = 0;
            let timeLeft = 900; // 15 minutes
            let initialWidth, initialHeight;

            // In a real scenario, login.html would save this. For now, we'll try to get it.
            agentId = localStorage.getItem('teamId') || 'Unknown Team'; // Default for direct access
            if (!agentId) {
                window.location.href = 'login.html';
                return;
            }
            agentIdDisplay.textContent = agentId;

            startAndSecureSession();

            function startAndSecureSession() {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                }
                caseWrapper.style.display = 'block';
                initialWidth = window.screen.width;
                initialHeight = window.screen.height;
                activateSecurityListeners();
                startTimer();
            }

            function resumeFromWarning() {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                }
                Object.values(overlays).forEach(overlay => overlay.style.display = 'none');
                resumeTimer();
            }

            function endSession(options = {}) {
                if (sessionHasEnded) return;
                sessionHasEnded = true;
                pauseTimer();

                let reason = options.reason === 'violation_limit' 
                    ? "Security protocol breached. Session terminated."
                    : "Session timed out. Archives locked.";
                
                alert(reason);

                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
                window.location.href = 'login.html';
            }

            function activateSecurityListeners() {
                const isLinux = navigator.userAgent.toLowerCase().includes('linux');

                function handleTabSwitch() {
                    if (sessionHasEnded) return;
                    tabSwitchCount++;
                    pauseTimer();

                    if (tabSwitchCount === 1) overlays.tab1.style.display = 'flex';
                    else if (tabSwitchCount === 2) overlays.tab2.style.display = 'flex';
                    else {
                        endSession({ reason: 'violation_limit' });
                    }
                }

                document.addEventListener('visibilitychange', () => { if (document.hidden) handleTabSwitch(); });
                window.addEventListener('blur', () => { if (isLinux) handleTabSwitch(); });
                window.addEventListener('resize', () => {
                    if (sessionHasEnded || !initialWidth || !initialHeight) return;
                    if (window.innerWidth < (initialWidth * 0.8) || window.innerHeight < (initialHeight * 0.8)) {
                        endSession({ reason: 'violation_limit' });
                    }
                });
                
                document.addEventListener('fullscreenchange', () => {
                    if (!document.fullscreenElement && !sessionHasEnded) {
                        escWarningCount++;
                        pauseTimer();
                        if (escWarningCount === 1) { overlays.esc1.style.display = 'flex'; }
                        else if (escWarningCount === 2) { overlays.esc2.style.display = 'flex'; }
                        else {
                            endSession({ reason: 'violation_limit' });
                        }
                    }
                });
                
                window.addEventListener('beforeunload', (e) => { if (!sessionHasEnded) { e.preventDefault(); e.returnValue = ''; } });
                document.addEventListener('contextmenu', (e) => e.preventDefault());
                const disableEvent = (e) => e.preventDefault();
                ['copy', 'paste', 'cut'].forEach(event => document.addEventListener(event, disableEvent));
                document.addEventListener('keydown', (e) => { if (!sessionHasEnded && (e.key === 'F5' || (e.ctrlKey && e.key === 'r'))) { e.preventDefault(); } });
            }
            
            function pauseTimer() { clearInterval(caseTimer); }
            function resumeTimer() {
                caseTimer = setInterval(() => {
                    timeLeft--;
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    if (timeLeft <= 0) {
                        clearInterval(caseTimer);
                        endSession();
                    }
                }, 1000);
            }
            function startTimer() { timeLeft = 900; resumeTimer(); }
        });
    </script>
</body>
</html>

